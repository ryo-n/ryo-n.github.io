<!doctype html><html class=no-js lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#1b1b1b"><title>AtCoder Python環境 | ryo_n</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content><link rel=stylesheet href=/css/bundle.css><link rel=icon href=/icons/16.png sizes=16x16 type=image/png><link rel=icon href=/icons/32.png sizes=32x32 type=image/png></head><body class="body kind-page"><header class=header><a class=logo href=/>ryo_n</a><nav class=main-nav role=navigation><button id=toggle class=main-nav__btn aria-label="Menu toggle" aria-expanded=false tabindex=0><div class=main-nav__btn-box tabindex=-1><svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18"><path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/><path class="icon-menu__x" d="M11.55 9 18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55.0 9 6.45 15.45.0 18 2.55 11.55 9z"/></svg></div></button><ul id=menu class=main-nav__list><li class=main-nav__item><a class=main-nav__link href="https://www.notion.so/ry0n/2d7eed95099e45a89ba0e25ba22fa65d?v=2cc963f963444f148962fc0ebd8f1e97"><span class=main-nav__text>問題解説</span></a></li></ul></nav></header><div class=primary><main class=main><div class="single block"><article class=entry><div class="entry__meta meta mb"><time class="entry__meta-published meta-published" datetime=2020-05-16T23:16:37+09:00>May 16, 2020</time></div><h1 class=entry__title>AtCoder Python環境</h1><div class=entry__content><p>2020年5月段階での自分のAtCoder環境をメモがてら書いておく。
Python環境を想定していますが、AtCoder関連のところは他言語利用者も参考になるかもしれない。
Macを利用している。
質問や分かりにくい点あれば追記するので <a href=https://twitter.com/ryo_n_code>@ryo_n_code</a> へ。</p><p>下記を目指したつもり</p><ul><li>コンテストサイト毎の環境を独立</li><li>複数マシン(デスクトップとラップトップ等) での利用も容易にする</li><li>シンプルな操作</li><li>サンプルのコピペ操作の排除</li><li>サンプルが通らないコードの提出防止</li></ul><h1 id=ソースコード管理>ソースコード管理</h1><h2 id=github>github</h2><p>gitを利用してバージョン管理をしている。
githubはプライベートリポジトリも無料で作成できるので、プライベートリポジトリを作成し、
ソースコードファイル、python環境管理ファイル(下記で記述)などもリポジトリ内に保存している。
ディレクトリ構造は下記のようになっている。
コンテスト毎にディレクトリを作成し、コンテストディレクトリの中に各問題ディレクトリが存在している。
各問題ディレクトリの中にソースコードと、testディレクトリが存在し、testディレクトリ内にサンプルが存在する。</p><pre><code>$ tree
.
├── abc001
│   ├── a
│   │   ├── main.py
│   │   └── test
│   │       ├── sample-1.in
│   │       ├── sample-1.out
│   │       ├── sample-2.in
│   │       ├── sample-2.out
│   │       ├── sample-3.in
│   │       └── sample-3.out
│   ├── b
│   │   ├── main.py
│   │   └── test
│   │       ├── sample-1.in
│   │       ├── sample-1.out
│   │       ├── sample-2.in
│   │       ├── sample-2.out
│   │       ├── sample-3.in
│   │       └── sample-3.out
</code></pre><h1 id=python環境>Python環境</h1><h2 id=pyenv>pyenv</h2><p><a href=https://github.com/pyenv/pyenv>https://github.com/pyenv/pyenv</a></p><p>環境毎にPythonのバージョンを切り替えるために使用。
AtCoderだと3.8.2だが、Codeforcesだと3.7.2が利用されている。</p><p>AtCoder環境のディレクトリで下記コマンドを実行すればPython 3.8.2が利用される</p><pre><code># 3.8.2をインストール
$ pyenv install 3.8.2
# 下記コマンドを実行したディレクトリ配下ではPython 3.8.2が使用されるようになる
$ pyenv local 3.8.2
</code></pre><h2 id=pipenv>pipenv</h2><p><a href=https://github.com/pypa/pipenv>https://github.com/pypa/pipenv</a></p><p>環境毎に依存モジュール管理をするために使用。
AtCoderだとnumpy, scipyが利用できるが、Codeforcesだと利用できなかったりする。</p><p>AtCoder環境のディレクトリで下記コマンドを実行すればPython 3.8.2環境で各モジュールが利用できるようになる。</p><pre><code>$ pipenv --python 3.8.2
$ pipenv install numpy scipy online-judge-tools
</code></pre><p>また、pipenvのスクリプト機能を利用し、自前ラッパースクリプトをpipenv環境で実行できるようにしている。</p><pre><code>$ pipenv run test
$ pipenv run submit
</code></pre><p>下記設定を入れておけば、上記コマンドで自前スクリプトを実行できる。
上記コマンドは各問題ディレクトリで実行されることを想定しているので相対パスでスクリプトを指定している。
(あまりイケてない、、?)</p><pre><code>$ cat Pipfile
[[source]]
name = &quot;pypi&quot;
url = &quot;https://pypi.org/simple&quot;
verify_ssl = true

[dev-packages]
pylint = &quot;*&quot;

[packages]
numpy = &quot;*&quot;
scipy = &quot;*&quot;
online-judge-tools = &quot;*&quot;

[requires]
python_version = &quot;3.8.2&quot;

[scripts]
test = &quot;../../test.sh&quot;
submit = &quot;../../submit.sh&quot;
</code></pre><h1 id=atcoder>AtCoder</h1><h2 id=online-judge-tools>online-judge-tools</h2><p><a href=https://github.com/online-judge-tools/oj>https://github.com/online-judge-tools/oj</a></p><p>サンプルのダウンロード、サンプルを利用したテストの実行、ソースコードの提出ができるようになる。</p><h2 id=atcoder-cli>atcoder-cli</h2><p><a href=https://github.com/Tatamo/atcoder-cli>https://github.com/Tatamo/atcoder-cli</a></p><p>コンテストを指定し、コンテスト内の各問題のサンプルのダウンロード、テンプレートを利用したソースコードの準備が可能になる。</p><h2 id=自前ラッパースクリプト>自前ラッパースクリプト</h2><h3 id=提出用>提出用</h3><p>カレントディレクトリから提出先を判別し、online-judgel-toolsを使って提出を可能にする。
提出前にサンプルのテストを実行し、テスト失敗した場合は警告を出すようにしている。</p><p>提出先URLの取得にatcoder-cliが作成したメタデータを利用してるので、jqコマンドを事前にインストールする必要がある。</p><p>submit.sh</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
path<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>

task<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> | rev | cut -d <span style=color:#e6db74>&#39;/&#39;</span> -f <span style=color:#ae81ff>1</span> | rev<span style=color:#66d9ef>)</span>
url<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>&lt; ../contest.acc.json jq -r <span style=color:#e6db74>&#34;.tasks[] | select(.directory.path == \&#34;</span><span style=color:#e6db74>${</span>task<span style=color:#e6db74>}</span><span style=color:#e6db74>\&#34;) | .url&#34;</span><span style=color:#66d9ef>)</span>

oj t -c <span style=color:#e6db74>&#34;python main.py&#34;</span>

<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span>$?<span style=color:#e6db74>&#34;</span> in
    1<span style=color:#f92672>)</span> echo <span style=color:#e6db74>&#34;Test is failed. If you want to submit the script. Please type yes.&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span>
       read -r answer
       <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span>$answer<span style=color:#e6db74>&#34;</span> in
           <span style=color:#e6db74>&#34;yes&#34;</span><span style=color:#f92672>)</span> echo <span style=color:#e6db74>&#34;submit script&#34;</span>;;
           *<span style=color:#f92672>)</span> exit <span style=color:#ae81ff>1</span>
       <span style=color:#66d9ef>esac</span>
<span style=color:#66d9ef>esac</span>

<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Python&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
    oj s -y -w <span style=color:#ae81ff>0</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>url<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> main.py --language Python
<span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;PyPy&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
    oj s -y -w <span style=color:#ae81ff>0</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>url<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> main.py --language <span style=color:#ae81ff>4047</span>
<span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;PyPyOld&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
    oj s -y -w <span style=color:#ae81ff>0</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>url<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> main.py --language <span style=color:#ae81ff>3510</span>
<span style=color:#66d9ef>else</span>
    oj s -y -w <span style=color:#ae81ff>0</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>url<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> main.py --language Python
<span style=color:#66d9ef>fi</span>
</code></pre></div><p>問題ディレクトリ配下で下記のようにスクリプトを呼び出す</p><pre><code>$ ../../submit.sh
</code></pre><h3 id=サンプルテスト用>サンプルテスト用</h3><p>下記はテストを実行するためのスクリプト
test.sh</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
oj t -c <span style=color:#e6db74>&#34;python main.py&#34;</span>

</code></pre></div><h3 id=コンテスト開始用>コンテスト開始用</h3><p>下記はコンテストを開始するためのスクリプト</p><ul><li>各問題URLをブラウザで開く</li><li>atcoder-cliを使って各問題サンプルを取得</li><li>atcoder-cliで作成されたテンプレートファイルをPyCharmで開く</li></ul><p>new.sh</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
contest<span style=color:#f92672>=</span>$1

open https://atcoder.jp/contests/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>/tasks/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>_a
open https://atcoder.jp/contests/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>/tasks/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>_b
open https://atcoder.jp/contests/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>/tasks/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>_c
open https://atcoder.jp/contests/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>/tasks/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>_d
open https://atcoder.jp/contests/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>/tasks/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>_e
open https://atcoder.jp/contests/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>/tasks/<span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>_f

acc new <span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>

charm <span style=color:#e6db74>${</span>contest<span style=color:#e6db74>}</span>/*/*.py
</code></pre></div><p>使い方</p><pre><code>$ ./new.sh abc123
</code></pre><h1 id=エディタ>エディタ</h1><h2 id=pycharm-ce>PyCharm CE</h2><p>VSCodeでも良いと思うが、PyCharmの方が若干賢い気がするので利用。</p><ul><li>Plugin<ul><li>IdeaVim<ul><li>vim操作を可能にする。</li></ul></li><li>Settings Repository<ul><li>PyCharmの設定をgithub上に保存することが可能になる。設定保存先リポジトリはgithubのプライベートリポジトリ。</li></ul></li></ul></li></ul><h1 id=ターミナル関連>ターミナル関連</h1><h2 id=iterm>iTerm</h2><p>Mac用ターミナル
Ctrl + ~ でアクティブにする設定を利用</p><h2 id=ghq>ghq</h2><p>gitリポジトリ管理用ツール。fzfと併用すれば容易にAtCoder環境ディレクトリに到達できる</p><h2 id=fzf>fzf</h2><p>fuzzy-finder。gitリポジトリをfuzzy-finderするためや、過去コマンドをfuzzy-finderするために利用。</p><h1 id=コンテスト時>コンテスト時</h1><h2 id=コンテスト開始時>コンテスト開始時</h2><p>下記コマンドで、問題文開く、サンプル取得、各問題ソースコードをPyCharm
で開く、A問題のディレクトリに移動をする</p><pre><code> ./new.sh abc167 &amp;&amp; cd abc167/a
</code></pre><h2 id=コンテスト中>コンテスト中</h2><h3 id=pycharmで問題を解く>PyCharmで問題を解く</h3><p>PyCharmのLive Templates(スニペット)も適宜利用。</p><h3 id=適当な入力を試す>適当な入力を試す</h3><ul><li>Ctrl + Shift + Rでコード実行。</li><li>Cmd + 4 でRunウィンドウへ移動。</li><li>適当な入力をする</li><li>出力の確認</li><li>Escでエディタに戻る</li></ul><h3 id=デバッグをする>デバッグをする</h3><ul><li>ブレークポイントを指定</li><li>Ctrl + Shift + Dでコード実行。</li><li>Cmd + 5 でDebugウィンドウへ移動。</li><li>適当な入力をする</li><li>F8押してステップ実行</li><li>適宜監視したい変数値をWatchに登録などをし監視</li><li>デバッグ、、</li></ul><h3 id=サンプルテストを実行>サンプルテストを実行</h3><p>ターミナル操作</p><pre><code>$ pwd
(略)../atcoder/abc167/a

# サンプルが通るかチェック
$ pipenv run test
[*] 3 cases found
time: illegal option -- f
usage: time [-lp] command.
[!] GNU time is not available: time

[*] sample-1
[x] time: 0.039492 sec
[+] AC

[*] sample-2
[x] time: 0.037746 sec
[+] AC

[*] sample-3
[x] time: 0.036085 sec
[+] AC

[x] slowest: 0.039492 sec  (for sample-1)
[+] test success: 3 caseso

</code></pre><h3 id=コードを提出>コードを提出</h3><p>ターミナル操作</p><pre><code># 提出前に再度サンプルテストが実行される
$ pipenv run submit Python

[*] 3 cases found
time: illegal option -- f
usage: time [-lp] command.
[!] GNU time is not available: time

[*] sample-1
[x] time: 0.036650 sec
[+] AC

[*] sample-2
[x] time: 0.035715 sec
[+] AC

[*] sample-3
[x] time: 0.035876 sec
[+] AC

[x] slowest: 0.036650 sec  (for sample-1)
[+] test success: 3 cases

(略)...

[x] PyPy is available for Python interpreter
[*] you can use `--no-guess` option if you want to do an unusual submission
[*] chosen language: 4006 (Python (3.8.2))
[!] the problem &quot;https://atcoder.jp/contests/abc167/tasks/abc167_a&quot; is specified to submit, but no samples were downloaded in this directory. this may be mis-operation
[x] open the submission page with browser
</code></pre><p>提出ページがブラウザで開かれるのでACするかを確認</p><h3 id=次の問題へ移動>次の問題へ移動</h3><ul><li>ターミナルのディレクトリ移動</li></ul><pre><code>$ cd ../b
</code></pre><ul><li>PyCharmで次の問題のソースコードを開く</li></ul><p>を繰り返す</p></div><footer class=entry__footer><div class=entry__tags><a class="entry__tag btn" href=/tags/atcoder/>atcoder</a>
<a class="entry__tag btn" href=/tags/python/>python</a>
<a class="entry__tag btn" href=/tags/env/>env</a>
<a class="entry__tag btn" href=/tags/programming/>programming</a>
<a class="entry__tag btn" href=/tags/competitive_programming/>competitive_programming</a>
<a class="entry__tag btn" href=/tags/mac/>Mac</a></div></footer></article></div></main></div><footer class=footer><div class="footer__social social"><a class=social__link target=_blank rel="noopener noreferrer" href=https://twitter.com/ryo_n_code><svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 01-40 12 72 72 0 0032-40 72 72 0 01-45 17 72 72 0 00-122 65 2e2 2e2.0 01-145-74 72 72 0 0022 94 72 72 0 01-32-7 72 72 0 0056 69 72 72 0 01-32 1 72 72 0 0067 50A2e2 2e2.0 0193 368a2e2 2e2.0 00309-179 2e2 2e2.0 0035-37"/></svg></a><a class=social__link target=_blank rel="noopener noreferrer" href=https://github.com/ryo-n><svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg></a></div><div class=footer__copyright>© 2021 map[holder:ryo_n startyear:2020]. <span class=footer__copyright-credits>Powered by <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/vimux/binario rel="nofollow noopener" target=_blank>Binario</a> theme.</span></div></footer><script src=/js/menu.js></script></body></html>